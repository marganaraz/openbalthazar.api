[{"SourceCode":"pragma solidity ^0.6.1;\r\n\r\n\r\n/**\r\n* Give Together\r\n* a no loss way to give to a\r\n* new charity each week\r\n* @author Lucas Kohorst\r\n* @dev This contract accepts ERC20 token which\r\n* if the donation time is past will forward the \r\n* tokens to a new charity each week. This can be \r\n* used stand alone but is intended to be designated\r\n* as a hat in the rToken project https://github.com/rtoken-project/rtoken-contracts\r\n* accured interest will be redeemed at this contract address\r\n* which will then be sent to the charity of the week\r\n*/\r\nabstract contract ERC20Token {\r\n   function transferFrom(address sender, address recipient, uint256 amount) virtual external returns (bool);\r\n   function balanceOf(address owner) virtual external view returns (uint256);\r\n   function approve(address spender, uint256 amount) virtual external returns (bool);\r\n}\r\ncontract GiveTogether  {\r\n    address payable public currentCharity;\r\n    address public owner;\r\n    mapping (address =\u003E Charity) public charities;\r\n    address payable [] public charityAccts;\r\n\r\n    uint256 public currentDate;\r\n    uint256 public sendDonationTime;\r\n    uint256 private oneWeek = 1 weeks;\r\n    uint256 public totalDonation;\r\n    uint256 public rDaiBalance;\r\n    bytes32 private N;\r\n\r\n    struct Charity  {\r\n        string name;\r\n        string website;\r\n        bool isCharity;\r\n    }\r\n\r\n    /**\r\n    * Modifier for owner specific functions\r\n    */\r\n    modifier isOwner() {\r\n        if (msg.sender != owner) revert();\r\n        _;\r\n    }\r\n\r\n    /**\r\n    * Constructor only run on contract creation\r\n    * adds intial charities, sets owner\r\n    * sets current date, current charity and \r\n    * current donation time\r\n    */\r\n    constructor() public {\r\n        // Setting the owner\r\n        owner = msg.sender;\r\n\r\n        // Adding intial charities\r\n        addCharity(0xD3F81260a44A1df7A7269CF66Abd9c7e4f8CdcD1, \u0022Heifer\u0022, \u0022https://www.heifer.org/\u0022); \r\n        addCharity(0xc1D5FD1F0D969075040988e37Df3643Af724995D, \u0022Grace Aid\u0022, \u0022https://graceaid.org/\u0022);\r\n        addCharity(0x6e4C6ADFA15cADa2699Fd2c16290ea1F71D0f9D7, \u0022Breast Cancer Support (UK)\u0022, \u0022https://breastcancersupport.org.uk/\u0022);\r\n        addCharity(0x50990F09d4f0cb864b8e046e7edC749dE410916b, \u0022350\u0022, \u0022https://350.org/\u0022);\r\n        addCharity(0xb189f76323678E094D4996d182A792E52369c005, \u0022EFF\u0022, \u0022https://www.eff.org/\u0022);\r\n        addCharity(0x998F25Be40241CA5D8F5fCaF3591B5ED06EF3Be7, \u0022Freedom of Press\u0022, \u0022https://freedom.press/\u0022);\r\n        addCharity(0xE000c5E5E74472B3584427c115712Eb325cf3ff5, \u0022Code for America\u0022, \u0022https://www.codeforamerica.org/\u0022);\r\n        addCharity(0xEF0050248aE8E5559Bdc6357cc2574fcDF434837, \u0022Fight for the Future\u0022, \u0022https://www.fightforthefuture.org/\u0022);\r\n        addCharity(0xc7464dbcA260A8faF033460622B23467Df5AEA42, \u0022Give Directly\u0022, \u0022https://www.givedirectly.org/\u0022);\r\n        addCharity(0x7cF2eBb5Ca55A8bd671A020F8BDbAF07f60F26C1, \u0022Give Well\u0022, \u0022https://www.givewell.org/\u0022);\r\n        addCharity(0x3ea5f030ade93A8D0400dcbDAC259e7348164fc1, \u0022Index of Censorship\u0022, \u0022https://www.indexoncensorship.org/\u0022);\r\n        addCharity(0x95a647B3d8a3F11176BAdB799b9499C671fa243a, \u0022Khan Academy\u0022, \u0022https://www.khanacademy.org/\u0022);\r\n        addCharity(0x19DdD94B94D3c68385c897846AB44Ac99DBFAe0f, \u0022Tor Project\u0022, \u0022https://www.torproject.org/\u0022);\r\n        addCharity(0x3a9f94DE63612f4A117Adf20F745bd420d148ac1, \u0022UNICEF New Zealand\u0022, \u0022https://www.unicef.org.nz/\u0022);\r\n        addCharity(0xC94BD2b79921DAa2395EB74934D867346C4C71d4, \u0022Rainforest Trust\u0022, \u0022https://www.rainforesttrust.org/\u0022);\r\n        addCharity(0xe0c83D05DB000393B22F85432F047167a5d650a8, \u0022FreeCodeCamp\u0022, \u0022https://www.freecodecamp.org/\u0022);\r\n        addCharity(0x682E9f760C5Be1A954A3e0499c5fb43faf4B86fB, \u0022Develop Africa\u0022, \u0022https://www.developafrica.org/\u0022);\r\n        addCharity(0x0AAD8B37E1f9a2AA3088c5bd3235bB120F40E8aD, \u0022The Lupus Foundation\u0022, \u0022https://www.lupus.org/\u0022);\t\r\n        addCharity(0x6B0d647Af6c9ff7CE6D507849eAbF649D045623e, \u0022Pathways to Education\u0022, \u0022https://www.pathwaystoeducation.ca/donate-ethereum/\u0022);\r\n        addCharity(0x0a91BC5990ebB27131FF81E97E7e2339433d1671, \u0022Rainforest Foundation\u0022, \u0022https://www.rainforestfoundation.org\u0022);\r\n\r\n        // Setting the default donation time\r\n        // to an hour before a week is over\r\n        sendDonationTime = 1 weeks - 1 hours;\r\n        currentDate = now;\r\n        // Generating random charity from hash of address\r\n        // Setting the nonce with the owner of the contract and time\r\n        N = keccak256(abi.encodePacked(owner, now));\r\n        bytes32 hash = keccak256(abi.encodePacked(N, msg.sender));\r\n        currentCharity = charityAccts[uint(hash) % charityAccts.length];\r\n    }   \r\n    \r\n    /**\r\n    * Default payable function; Gets called when an ERC20 token is sent\r\n    * to the contracta nd forwards\r\n    * it to the destination address\r\n    * which is the charity of the week\r\n    */\r\n    receive() external payable {\r\n        // Checking that there is an ERC20 token being sent \r\n        // and that the donation time is passed\r\n        if (msg.value \u003E 0) {\r\n            // Adding to total donation\r\n            totalDonation = totalDonation \u002B  msg.value;\r\n            // Sending any ETH in the account\r\n            if (!currentCharity.send(address(this).balance)) revert();\r\n        }\r\n        // Getting a new charity and send donation time\r\n        // are less than current time that means\r\n        // the previous charity expired\r\n        if(now \u003E= currentDate \u002B sendDonationTime) {\r\n           currentDate = now;\r\n           currentCharity = generateNewCharity();\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n    * If need a new charity can be generated\r\n    * @return currentCharity the address of the current charity\r\n    * @dev only callable by owner\r\n    */\r\n    function generateNewCharity() public isOwner returns (address payable) {\r\n        // Generating new nonce from the owner and the time\r\n        N = keccak256(abi.encodePacked(owner, now));\r\n        bytes32 hash = keccak256(abi.encodePacked(N, msg.sender));\r\n        currentCharity = charityAccts[uint(hash) % charityAccts.length];\r\n        if (!charities[currentCharity].isCharity) generateNewCharity();\r\n        return currentCharity;\r\n    }\r\n\r\n    /**\r\n    * Withdraws rDAI and ETH balance to current charity\r\n    */\r\n    function withdrawRDAI() public {\r\n        ERC20Token tok = ERC20Token(0x261b45D85cCFeAbb11F022eBa346ee8D1cd488c0);\r\n        rDaiBalance = tok.balanceOf(address(this));\r\n        totalDonation = totalDonation \u002B rDaiBalance;\r\n        require(rDaiBalance \u003E 0);\r\n        tok.approve(address(this), rDaiBalance);\r\n        tok.transferFrom(address(this), currentCharity, rDaiBalance);\r\n        rDaiBalance = tok.balanceOf(address(this));\r\n\r\n        // Getting a new charity and send donation time\r\n        // are less than current time that means\r\n        // the previous charity expired\r\n        if(now \u003E= currentDate \u002B sendDonationTime) {\r\n           currentDate = now;\r\n           currentCharity = generateNewCharity();\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Adds a charity if it is not there already\r\n    * @param _addr charity\u0027s donation address\r\n    * @param _name charity\u0027s name\r\n    * @param _website charity\u0027s website\r\n    * @dev only callable by owner\r\n    */\r\n    function addCharity(address payable _addr, string memory _name, string memory _website) public isOwner {\r\n        if (charities[_addr].isCharity) revert();\r\n        charities[_addr] = Charity(_name, _website, true);\r\n        charityAccts.push(_addr);\r\n    }\r\n\r\n    /**\r\n    * Removes a charity\r\n    * @param _addr charity\u0027s donation address\r\n    * @dev only callable by owner\r\n    * @dev https://ethereum.stackexchange.com/questions/1527/how-to-delete-an-element-at-a-certain-index-in-an-array\r\n    */\r\n    function removeCharity(address payable _addr) public isOwner {\r\n       for (uint i = 0; i \u003C charityAccts.length; i\u002B\u002B) {\r\n           if (charityAccts[i] == _addr) {\r\n               // Will leave empty space in the array\r\n               delete charityAccts[i];\r\n           }\r\n       }\r\n    }\r\n\r\n    /**\r\n    * Sets time to generate new charity\r\n    * @param _time donation time\r\n    */\r\n    function setSendDonationTime(uint256 _time) public isOwner {\r\n        sendDonationTime = _time;\r\n    }\r\n\r\n\r\n    /**\r\n    * Gets name and website for each charity\r\n    * based on addres\r\n    * @param addr address to get charity by\r\n    * @return addr address of the charity\r\n    * @return name charity name\r\n    * @return website charity\u0027s website\r\n    */\r\n    function getCharities(address addr) public view returns (address, string memory, string memory, bool) {\r\n        return (addr, charities[addr].name, charities[addr].website, charities[addr].isCharity);\r\n    }\r\n\r\n    /** \r\n    * Get number of charities\r\n    * @return charityAccts length how many charities there are\r\n    */\r\n    function getNumCharities() public view returns(uint) {\r\n        return charityAccts.length;\r\n    }\r\n    \r\n    /**\r\n    * Sets new owner\r\n    * @param newOwner, new contract owner\r\n    */\r\n    function transferOwner(address newOwner) public isOwner {\r\n        require(msg.sender == owner);\r\n        owner = newOwner;\r\n    }\r\n\r\n}","ABI":"[{\u0022inputs\u0022:[],\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022constructor\u0022},{\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address payable\u0022,\u0022name\u0022:\u0022_addr\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022string\u0022,\u0022name\u0022:\u0022_name\u0022,\u0022type\u0022:\u0022string\u0022},{\u0022internalType\u0022:\u0022string\u0022,\u0022name\u0022:\u0022_website\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022name\u0022:\u0022addCharity\u0022,\u0022outputs\u0022:[],\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022charities\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022string\u0022,\u0022name\u0022:\u0022name\u0022,\u0022type\u0022:\u0022string\u0022},{\u0022internalType\u0022:\u0022string\u0022,\u0022name\u0022:\u0022website\u0022,\u0022type\u0022:\u0022string\u0022},{\u0022internalType\u0022:\u0022bool\u0022,\u0022name\u0022:\u0022isCharity\u0022,\u0022type\u0022:\u0022bool\u0022}],\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022charityAccts\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address payable\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[],\u0022name\u0022:\u0022currentCharity\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address payable\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[],\u0022name\u0022:\u0022currentDate\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[],\u0022name\u0022:\u0022generateNewCharity\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address payable\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022addr\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022getCharities\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022string\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022string\u0022},{\u0022internalType\u0022:\u0022string\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022string\u0022},{\u0022internalType\u0022:\u0022bool\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022bool\u0022}],\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[],\u0022name\u0022:\u0022getNumCharities\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[],\u0022name\u0022:\u0022owner\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[],\u0022name\u0022:\u0022rDaiBalance\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address payable\u0022,\u0022name\u0022:\u0022_addr\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022removeCharity\u0022,\u0022outputs\u0022:[],\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[],\u0022name\u0022:\u0022sendDonationTime\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022_time\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022setSendDonationTime\u0022,\u0022outputs\u0022:[],\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[],\u0022name\u0022:\u0022totalDonation\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022newOwner\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022transferOwner\u0022,\u0022outputs\u0022:[],\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[],\u0022name\u0022:\u0022withdrawRDAI\u0022,\u0022outputs\u0022:[],\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022stateMutability\u0022:\u0022payable\u0022,\u0022type\u0022:\u0022receive\u0022}]","ContractName":"GiveTogether","CompilerVersion":"v0.6.1\u002Bcommit.e6f7d5a4","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"ipfs://11b0918e3043ba79ef89ad662b3f7bd373f5cf72116b1410c47ce8e0f5fb23d8"}]