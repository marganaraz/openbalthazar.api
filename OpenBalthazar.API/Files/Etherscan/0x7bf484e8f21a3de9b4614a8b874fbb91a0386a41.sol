[{"SourceCode":"pragma solidity 0.5.11;\r\n\r\nlibrary SafeMath {\r\n\r\n    function mul(uint256 a, uint256 b) internal pure returns (uint256) {\r\n        if (a == 0) {\r\n            return 0;\r\n        }\r\n\r\n        uint256 c = a * b;\r\n        require(c / a == b, \u0022SafeMath: multiplication overflow\u0022);\r\n\r\n        return c;\r\n    }\r\n\r\n    function div(uint256 a, uint256 b) internal pure returns (uint256) {\r\n        require(b \u003E 0, \u0022SafeMath: division by zero\u0022);\r\n        uint256 c = a / b;\r\n\r\n        return c;\r\n    }\r\n\r\n    function sub(uint256 a, uint256 b) internal pure returns (uint256) {\r\n        require(b \u003C= a, \u0022SafeMath: subtraction overflow\u0022);\r\n        uint256 c = a - b;\r\n\r\n        return c;\r\n    }\r\n\r\n    function add(uint256 a, uint256 b) internal pure returns (uint256) {\r\n        uint256 c = a \u002B b;\r\n        require(c \u003E= a, \u0022SafeMath: addition overflow\u0022);\r\n\r\n        return c;\r\n    }\r\n}\r\n\r\n/**\r\n * @title BTALToken interface\r\n */\r\ninterface IBTALToken {\r\n    function transfer(address to, uint256 value) external returns (bool);\r\n    function transferFrom(address from, address to, uint256 value) external returns (bool);\r\n    function balanceOf(address who) external view returns (uint256);\r\n    function released() external view returns (bool);\r\n    function isAdmin(address account) external view returns (bool);\r\n}\r\n\r\n/**\r\n * @title Crowdsale interface\r\n */\r\ninterface ICrowdsale {\r\n    function reserved() external view returns (uint256);\r\n    function reserveLimit() external view returns (uint256);\r\n    function reserveTrigger() external view returns (uint256);\r\n    function isEnlisted(address account) external view returns (bool);\r\n}\r\n\r\n/**\r\n * @title Exchange contract\r\n */\r\ncontract Exchange {\r\n    using SafeMath for uint256;\r\n\r\n    IBTALToken public BTAL;\r\n    ICrowdsale public crowdsale;\r\n\r\n    address payable private _reserveAddress;\r\n\r\n    uint256 private _balance;\r\n\r\n    modifier inActiveState() {\r\n        require(\r\n            crowdsale.reserved() \u003E= crowdsale.reserveLimit()\r\n            \u0026\u0026 !BTAL.released()\r\n            );\r\n        _;\r\n    }\r\n\r\n    modifier onlyAdmin() {\r\n        require(BTAL.isAdmin(msg.sender), \u0022Caller has no permission\u0022);\r\n        _;\r\n    }\r\n\r\n    event Exchanged(address user, uint256 tokenAmount, uint256 weiAmount);\r\n    event BalanceIncreased(address user, uint256 amount);\r\n\r\n    constructor(address BTALAddr, address crowdsaleAddr, address payable reserveAddress) public {\r\n        require(BTALAddr != address(0) \u0026\u0026 crowdsaleAddr != address(0) \u0026\u0026 reserveAddress != address(0));\r\n\r\n        BTAL = IBTALToken(BTALAddr);\r\n        crowdsale = ICrowdsale(crowdsaleAddr);\r\n        _reserveAddress = reserveAddress;\r\n        _balance = address(this).balance;\r\n    }\r\n\r\n    function() external payable {\r\n        acceptETH();\r\n    }\r\n\r\n    function acceptETH() public payable {\r\n        _balance \u002B= msg.value;\r\n        emit BalanceIncreased(msg.sender, msg.value);\r\n    }\r\n\r\n    function receiveApproval(address payable from, uint256 amount, address token, bytes calldata extraData) external {\r\n        require(token == address(BTAL));\r\n        exchange(from, amount);\r\n    }\r\n\r\n    function exchange(address payable account, uint256 amount) public inActiveState {\r\n        require(crowdsale.isEnlisted(account));\r\n        BTAL.transferFrom(account, address(this), amount);\r\n        BTAL.transfer(_reserveAddress, amount);\r\n\r\n        uint256 weiAmount = getETHAmount(amount);\r\n\r\n        account.transfer(weiAmount);\r\n\r\n        emit Exchanged(account, amount, weiAmount);\r\n    }\r\n\r\n    function finish() public onlyAdmin {\r\n        require(BTAL.released());\r\n        _reserveAddress.transfer(address(this).balance);\r\n    }\r\n\r\n    function setCrowdsaleAddr(address addr) public onlyAdmin {\r\n        require(addr != address(0));\r\n        require(isContract(addr));\r\n        crowdsale = ICrowdsale(addr);\r\n    }\r\n\r\n    function withdrawERC20(address ERC20Token, address recipient) external onlyAdmin {\r\n\r\n        uint256 amount = IBTALToken(ERC20Token).balanceOf(address(this));\r\n        require(amount \u003E 0);\r\n        IBTALToken(ERC20Token).transfer(recipient, amount);\r\n\r\n    }\r\n\r\n    function enlisted(address addr) public view returns(bool) {\r\n        if (addr == address(this)) {\r\n            return true;\r\n        }\r\n        return crowdsale.isEnlisted(addr);\r\n    }\r\n\r\n    function getETHAmount(uint256 tokenAmount) public view returns(uint256) {\r\n        return tokenAmount.mul(_balance).div(crowdsale.reserveTrigger());\r\n    }\r\n\r\n    function reserveAddress() public view returns(address payable) {\r\n        return _reserveAddress;\r\n    }\r\n\r\n    function isContract(address addr) internal view returns (bool) {\r\n        uint size;\r\n        assembly { size := extcodesize(addr) }\r\n        return size \u003E 0;\r\n    }\r\n\r\n}","ABI":"[{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address payable\u0022,\u0022name\u0022:\u0022account\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022amount\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022exchange\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022BTAL\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022contract IBTALToken\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address payable\u0022,\u0022name\u0022:\u0022from\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022amount\u0022,\u0022type\u0022:\u0022uint256\u0022},{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022token\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022bytes\u0022,\u0022name\u0022:\u0022extraData\u0022,\u0022type\u0022:\u0022bytes\u0022}],\u0022name\u0022:\u0022receiveApproval\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022ERC20Token\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022recipient\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022withdrawERC20\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022crowdsale\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022contract ICrowdsale\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022acceptETH\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:true,\u0022stateMutability\u0022:\u0022payable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022addr\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022enlisted\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022bool\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022bool\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022finish\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022addr\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022setCrowdsaleAddr\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022tokenAmount\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022getETHAmount\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022reserveAddress\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address payable\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022BTALAddr\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022crowdsaleAddr\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022address payable\u0022,\u0022name\u0022:\u0022reserveAddress\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022constructor\u0022},{\u0022payable\u0022:true,\u0022stateMutability\u0022:\u0022payable\u0022,\u0022type\u0022:\u0022fallback\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022user\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022tokenAmount\u0022,\u0022type\u0022:\u0022uint256\u0022},{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022weiAmount\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022Exchanged\u0022,\u0022type\u0022:\u0022event\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022user\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022amount\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022BalanceIncreased\u0022,\u0022type\u0022:\u0022event\u0022}]","ContractName":"Exchange","CompilerVersion":"v0.5.11\u002Bcommit.c082d0b4","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"000000000000000000000000a888643d9284c02ef149308aed7cc8517e02fac4000000000000000000000000cd5ff8c51b39395183d823092e4a9e911d8097b2000000000000000000000000156b520ab3bd39919d0ded338a1f4af3efb60fc4","Library":"","SwarmSource":"bzzr://f54e2fb40926135ad9f44d0a713f037692bce36167382397522d47c756ca5338"}]