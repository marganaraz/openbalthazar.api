[{"SourceCode":"pragma solidity \u003E0.4.99 \u003C0.6.0;\r\n\r\ncontract Username {\r\n  string public constant version = \u00270.3.0\u0027;\r\n  event Updated(address indexed user, string indexed username);\r\n\r\n  mapping(address =\u003E string) public username;\r\n  mapping(string =\u003E address) public owner;\r\n  mapping(string =\u003E string) public caseMap;\r\n\r\n  string constant availableChrs = \u0027abcdefghijklmnopqrstuvwxyz0123456789\u0027;\r\n  string constant symbols = \u0022_-.\u0022;\r\n\r\n  bytes bAvailableChrs = bytes(availableChrs);\r\n  bytes bSymbols = bytes(symbols);\r\n\r\n  function getUsername(address addr) public view returns (string memory) {\r\n    return caseMap[username[addr]];\r\n  }\r\n\r\n  function getOwner(string memory username) public view returns (address) {\r\n    return owner[toLower(username)];\r\n  }\r\n\r\n  function isSymbol(bytes1 chr) internal view returns (bool result) {\r\n    for (uint8 i = 0; i \u003C bSymbols.length; i\u002B\u002B) {\r\n      if (chr == bSymbols[i]) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function isAlphaNumeric(bytes1 chr) internal view returns (bool result) {\r\n    for (uint8 i = 0; i \u003C bAvailableChrs.length; i\u002B\u002B) {\r\n      if (chr == bAvailableChrs[i]) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function toLower(string memory str) public view returns (string memory) {\r\n    bytes memory bStr = bytes(str);\r\n\t\tbytes memory bLower = new bytes(bStr.length);\r\n    for (uint8 i = 0; i \u003C bStr.length; i\u002B\u002B) {\r\n      if (uint8(bStr[i]) \u003E 65 \u0026\u0026 uint8(bStr[i]) \u003C= 90) {\r\n        bLower[i] = bytes1(uint8(bStr[i]) \u002B 32);\r\n      } else {\r\n        bLower[i] = bStr[i];\r\n      }\r\n    }\r\n    return string(bLower);\r\n  }\r\n\r\n  function validate(string memory str) public view returns (bool result) {\r\n    bytes memory bStr = bytes(str);\r\n    if (bStr.length \u003C 1 || bStr.length \u003E 20) {\r\n      return false;\r\n    }\r\n    bool continuousFlag = false;\r\n    for (uint8 i = 0; i \u003C bStr.length; i\u002B\u002B) {\r\n      if (isSymbol(bStr[i])) {\r\n        if (i == 0 || i == bStr.length - 1 || continuousFlag) {\r\n          return false;\r\n        }\r\n        continuousFlag = true;\r\n      } else if (isAlphaNumeric(bStr[i])) {\r\n        continuousFlag = false;\r\n      } else  {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  function update(string memory _username) public {\r\n    string memory lowerUsername = toLower(_username);\r\n    if (owner[lowerUsername] != address(0) \u0026\u0026 owner[lowerUsername] != msg.sender) {\r\n      revert(\u0022Username already used\u0022);\r\n    }\r\n\r\n    require(validate(lowerUsername));\r\n\r\n    string memory oldUserName = username[msg.sender];\r\n\r\n    owner[oldUserName] = address(0);\r\n    owner[lowerUsername] = msg.sender;\r\n\r\n    username[msg.sender] = lowerUsername;\r\n\r\n    caseMap[oldUserName] = \u0022\u0022;\r\n    caseMap[lowerUsername] = _username;\r\n\r\n    emit Updated(msg.sender, _username);\r\n  }\r\n}","ABI":"[{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022username\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022name\u0022:\u0022_username\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022name\u0022:\u0022update\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022name\u0022:\u0022username\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022name\u0022:\u0022getOwner\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022version\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022name\u0022:\u0022caseMap\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022name\u0022:\u0022str\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022name\u0022:\u0022toLower\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022name\u0022:\u0022addr\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022getUsername\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022name\u0022:\u0022str\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022name\u0022:\u0022validate\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022result\u0022,\u0022type\u0022:\u0022bool\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022name\u0022:\u0022owner\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[{\u0022indexed\u0022:true,\u0022name\u0022:\u0022user\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022indexed\u0022:true,\u0022name\u0022:\u0022username\u0022,\u0022type\u0022:\u0022string\u0022}],\u0022name\u0022:\u0022Updated\u0022,\u0022type\u0022:\u0022event\u0022}]","ContractName":"Username","CompilerVersion":"v0.5.10\u002Bcommit.5a6ea5b1","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://bf806ea221c338c2b1e357d5dcb60149e1e272c544759e88b24f960c7530b82f"}]