[{"SourceCode":"pragma solidity ^0.5.11;\r\n\r\n\r\ncontract GuessTheNumberGame {\r\n    \r\n    // Events\r\n    event GameCreated(uint bet);\r\n    event GameOpened(address notary);\r\n    event GameClosed();\r\n    event GuessSubmitted(address player, uint guess);\r\n    \r\n    event ResultSubmitted(uint result);\r\n    event PlayersWin(uint winningNumber, uint256 jackpot);\r\n    event OwnerWins();\r\n    \r\n    // Data types\r\n    enum State {\r\n        SETUP, OPEN, CLOSED, PLAYERS_WIN, OWNER_WIN\r\n    }\r\n\r\n    enum PaidStatus {\r\n        UNDEFINED,\r\n        NOT_PAID,\r\n        PAID\r\n    }\r\n    \r\n    struct Guess {\r\n        mapping (address =\u003E PaidStatus) players;\r\n        uint guesses_number;\r\n    }\r\n    \r\n    // Variables\r\n    address payable public owner;\r\n    address public notary;\r\n    State public state;\r\n\r\n    mapping (uint =\u003E Guess) public guesses;\r\n\r\n    uint256 public bet;\r\n    \r\n    uint public winningNumber = 0;\r\n    uint256 splitJackpot;\r\n\r\n    \r\n    // ----------MODIFIERS--------------------\r\n    modifier byPlayer(){\r\n        require(msg.sender != notary);\r\n        _;\r\n    }\r\n    \r\n    // Checks if the sender is the owner\r\n    modifier byOwner(){\r\n        require(msg.sender == owner);\r\n        _;\r\n    }\r\n    \r\n    // Checks if the sender is the notary\r\n    modifier byNotary(){\r\n        require(msg.sender == notary);\r\n        _;\r\n    }\r\n    \r\n    // Checks the status\r\n    modifier inState(State expected) {\r\n        require(state == expected);\r\n        _;\r\n    }\r\n    // -------------------------------------\r\n\r\n    constructor(uint256 _bet) public {\r\n        require(_bet \u003E 0);\r\n        \r\n        owner = msg.sender;\r\n        state = State.SETUP;\r\n        bet = _bet;\r\n        \r\n        emit GameCreated(bet);\r\n    }\r\n    \r\n    function openGame(address _notary) public byOwner inState(State.SETUP){\r\n        notary = _notary;\r\n        state = State.OPEN;\r\n        \r\n        emit GameOpened(notary);\r\n    }\r\n    \r\n    function closeGame() public byOwner inState(State.OPEN){\r\n        state = State.CLOSED;\r\n        \r\n        emit GameClosed();\r\n    }\r\n    \r\n    function submitGuess(uint _guess) public payable byPlayer inState(State.OPEN) {\r\n        require(isValidNumber(_guess));\r\n        require(msg.value == (bet * 0.001 ether));\r\n\r\n        guesses[_guess].guesses_number\u002B\u002B;\r\n        guesses[_guess].players[msg.sender] = PaidStatus.NOT_PAID;\r\n        \r\n        emit GuessSubmitted(msg.sender, _guess);\r\n    }\r\n    \r\n    function submitResult(uint _result) public payable byNotary inState(State.CLOSED) {\r\n        require(isValidNumber(_result));\r\n        emit ResultSubmitted(_result);\r\n         \r\n        for(uint i = _result; (i \u003E 0 \u0026\u0026 state != State.PLAYERS_WIN); i--){\r\n            if(guesses[i].guesses_number \u003E 0){\r\n                winningNumber = i;\r\n                state = State.PLAYERS_WIN;\r\n                splitJackpot = getBalance()/guesses[i].guesses_number;\r\n                emit PlayersWin(winningNumber, splitJackpot);\r\n            }\r\n        }\r\n\r\n        if(state != State.PLAYERS_WIN){\r\n            state = State.OWNER_WIN;\r\n            emit OwnerWins();\r\n        }\r\n    }\r\n    \r\n    function collectOwnerWinnings() public byOwner inState(State.OWNER_WIN){\r\n        selfdestruct(owner);\r\n    }\r\n    \r\n    function collectPlayerWinnings() public byPlayer inState(State.PLAYERS_WIN){\r\n        if(guesses[winningNumber].players[msg.sender] == PaidStatus.NOT_PAID){\r\n            guesses[winningNumber].players[msg.sender] = PaidStatus.PAID;\r\n            msg.sender.transfer(splitJackpot);\r\n        } else revert();\r\n    }\r\n\r\n    function getBalance() private view returns (uint256){\r\n        return address(this).balance;\r\n    }\r\n    \r\n    function isValidNumber(uint _guess) private pure returns (bool) {\r\n        return _guess \u003E= 1 \u0026\u0026 _guess \u003C= 1000;\r\n    } \r\n    \r\n}","ABI":"[{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022bet\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022guesses\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022guesses_number\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022_result\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022submitResult\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:true,\u0022stateMutability\u0022:\u0022payable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022winningNumber\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022closeGame\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022_notary\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022openGame\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022owner\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address payable\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022notary\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022state\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022enum GuessTheNumberGame.State\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint8\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022collectOwnerWinnings\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022collectPlayerWinnings\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022_guess\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022submitGuess\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:true,\u0022stateMutability\u0022:\u0022payable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022_bet\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022constructor\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022bet\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022GameCreated\u0022,\u0022type\u0022:\u0022event\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022notary\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022GameOpened\u0022,\u0022type\u0022:\u0022event\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022GameClosed\u0022,\u0022type\u0022:\u0022event\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022player\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022guess\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022GuessSubmitted\u0022,\u0022type\u0022:\u0022event\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022result\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022ResultSubmitted\u0022,\u0022type\u0022:\u0022event\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022winningNumber\u0022,\u0022type\u0022:\u0022uint256\u0022},{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022jackpot\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022PlayersWin\u0022,\u0022type\u0022:\u0022event\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022OwnerWins\u0022,\u0022type\u0022:\u0022event\u0022}]","ContractName":"GuessTheNumberGame","CompilerVersion":"v0.5.11\u002Bcommit.c082d0b4","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"0000000000000000000000000000000000000000000000000000000000000004","Library":"","SwarmSource":"bzzr://1904520524622bcc8904238b4f50699a0e63f49913a58b5251ed2c4ff06aa80f"}]