[{"SourceCode":"/**\r\n *Submitted for verification at Etherscan.io on 2019-11-13\r\n*/\r\n\r\n// File: contracts/common/Validating.sol\r\n\r\npragma solidity 0.5.12;\r\n\r\n\r\ninterface Validating {\r\n  modifier notZero(uint number) { require(number \u003E 0, \u0022invalid 0 value\u0022); _; }\r\n  modifier notEmpty(string memory text) { require(bytes(text).length \u003E 0, \u0022invalid empty string\u0022); _; }\r\n  modifier validAddress(address value) { require(value != address(0x0), \u0022invalid address\u0022); _; }\r\n}\r\n\r\n// File: contracts/gluon/AppGovernance.sol\r\n\r\npragma solidity 0.5.12;\r\n\r\n\r\ninterface AppGovernance {\r\n  function approve(uint32 id) external;\r\n  function disapprove(uint32 id) external;\r\n  function activate(uint32 id) external;\r\n}\r\n\r\n// File: contracts/gluon/AppLogic.sol\r\n\r\npragma solidity 0.5.12;\r\n\r\n\r\ninterface AppLogic {\r\n  function upgrade() external;\r\n  function credit(address account, address asset, uint quantity) external;\r\n  function debit(address account, bytes calldata parameters) external returns (address asset, uint quantity);\r\n}\r\n\r\n// File: contracts/gluon/AppState.sol\r\n\r\npragma solidity 0.5.12;\r\n\r\n\r\ncontract AppState {\r\n\r\n  enum State { OFF, ON, RETIRED }\r\n  State public state = State.ON;\r\n  event Off();\r\n  event Retired();\r\n\r\n  modifier whenOn() { require(state == State.ON, \u0022must be on\u0022); _; }\r\n  modifier whenOff() { require(state == State.OFF, \u0022must be off\u0022); _; }\r\n  modifier whenRetired() { require(state == State.RETIRED, \u0022must be retired\u0022); _; }\r\n\r\n  function retire_() internal whenOn {\r\n    state = State.RETIRED;\r\n    emit Retired();\r\n  }\r\n\r\n  function switchOff_() internal whenOn {\r\n    state = State.OFF;\r\n    emit Off();\r\n  }\r\n\r\n  function isOn() external view returns (bool) { return state == State.ON; }\r\n}\r\n\r\n// File: contracts/gluon/GluonView.sol\r\n\r\npragma solidity 0.5.12;\r\n\r\n\r\ninterface GluonView {\r\n  function app(uint32 id) external view returns (address current, address proposal, uint activationBlock);\r\n  function current(uint32 id) external view returns (address);\r\n  function history(uint32 id) external view returns (address[] memory);\r\n  function getBalance(uint32 id, address asset) external view returns (uint);\r\n  function isAnyLogic(uint32 id, address logic) external view returns (bool);\r\n  function isAppOwner(uint32 id, address appOwner) external view returns (bool);\r\n  function proposals(address logic) external view returns (bool);\r\n  function totalAppsCount() external view returns(uint32);\r\n}\r\n\r\n// File: contracts/gluon/GluonCentric.sol\r\n\r\npragma solidity 0.5.12;\r\n\r\n\r\n\r\ncontract GluonCentric {\r\n  uint32 internal constant REGISTRY_INDEX = 0;\r\n  uint32 internal constant STAKE_INDEX = 1;\r\n\r\n  uint32 public id;\r\n  address public gluon;\r\n\r\n  constructor(uint32 id_, address gluon_) public {\r\n    id = id_;\r\n    gluon = gluon_;\r\n  }\r\n\r\n  modifier onlyCurrentLogic { require(currentLogic() == msg.sender, \u0022invalid sender; must be current logic contract\u0022); _; }\r\n  modifier onlyGluon { require(gluon == msg.sender, \u0022invalid sender; must be gluon contract\u0022); _; }\r\n  modifier onlyOwner { require(GluonView(gluon).isAppOwner(id, msg.sender), \u0022invalid sender; must be app owner\u0022); _; }\r\n\r\n  function currentLogic() public view returns (address) { return GluonView(gluon).current(id); }\r\n}\r\n\r\n// File: contracts/apps/registry/RegistryData.sol\r\n\r\npragma solidity 0.5.12;\r\n\r\n\r\n\r\ncontract RegistryData is GluonCentric {\r\n\r\n  mapping(address =\u003E address) public accounts;\r\n\r\n  constructor(address gluon) GluonCentric(REGISTRY_INDEX, gluon) public { }\r\n\r\n  function addKey(address apiKey, address account) external onlyCurrentLogic {\r\n    accounts[apiKey] = account;\r\n  }\r\n\r\n}\r\n\r\n// File: contracts/gluon/Upgrading.sol\r\n\r\npragma solidity 0.5.12;\r\n\r\n\r\n\r\n\r\ncontract Upgrading {\r\n  address public upgradeOperator;\r\n\r\n  modifier onlyOwner { require(false, \u0022modifier onlyOwner must be implemented\u0022); _; }\r\n  modifier onlyUpgradeOperator { require(upgradeOperator == msg.sender, \u0022invalid sender; must be upgrade operator\u0022); _; }\r\n  function setUpgradeOperator(address upgradeOperator_) external onlyOwner { upgradeOperator = upgradeOperator_; }\r\n  function upgrade_(AppGovernance appGovernance, uint32 id) internal {\r\n    appGovernance.activate(id);\r\n    delete upgradeOperator;\r\n  }\r\n}\r\n\r\n// File: contracts/apps/registry/RegistryLogic.sol\r\n\r\npragma solidity 0.5.12;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\ncontract RegistryLogic is Upgrading, Validating, AppLogic, AppState, GluonCentric {\r\n\r\n  RegistryData public data;\r\n  OldRegistry public old;\r\n\r\n  event Registered(address apiKey, address indexed account);\r\n\r\n  constructor(address gluon, address old_, address data_) GluonCentric(REGISTRY_INDEX, gluon) public {\r\n    data = RegistryData(data_);\r\n    old = OldRegistry(old_);\r\n  }\r\n\r\n  modifier isAbsent(address apiKey) { require(translate(apiKey) == address (0x0), \u0022api key already in use\u0022); _; }\r\n\r\n  function register(address apiKey) external whenOn validAddress(apiKey) isAbsent(apiKey) {\r\n    data.addKey(apiKey, msg.sender);\r\n    emit Registered(apiKey, msg.sender);\r\n  }\r\n\r\n  function translate(address apiKey) public view returns (address) {\r\n    address account = data.accounts(apiKey);\r\n    if (account == address(0x0)) account = old.translate(apiKey);\r\n    return account;\r\n  }\r\n\r\n  /**************************************************** AppLogic ****************************************************/\r\n\r\n  function upgrade() external onlyUpgradeOperator {\r\n    retire_();\r\n    upgrade_(AppGovernance(gluon), id);\r\n  }\r\n\r\n  function credit(address, address, uint) external { revert(\u0022not supported\u0022); }\r\n\r\n  function debit(address, bytes calldata) external returns (address, uint) { revert(\u0022not supported\u0022); }\r\n\r\n  function switchOff() external onlyOwner {\r\n    uint32 totalAppsCount = GluonView(gluon).totalAppsCount();\r\n    for (uint32 i = 2; i \u003C totalAppsCount; i\u002B\u002B) {\r\n      AppState appState = AppState(GluonView(gluon).current(i));\r\n      require(!appState.isOn(), \u0022One of the apps is still ON\u0022);\r\n    }\r\n    switchOff_();\r\n  }\r\n}\r\n\r\n\r\ncontract OldRegistry {\r\n  function translate(address) public view returns (address);\r\n}","ABI":"[{\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022gluon\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022old_\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022data_\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022constructor\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022Off\u0022,\u0022type\u0022:\u0022event\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[{\u0022indexed\u0022:false,\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022apiKey\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022indexed\u0022:true,\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022account\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022Registered\u0022,\u0022type\u0022:\u0022event\u0022},{\u0022anonymous\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022Retired\u0022,\u0022type\u0022:\u0022event\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022credit\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022currentLogic\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022data\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022contract RegistryData\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022bytes\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022bytes\u0022}],\u0022name\u0022:\u0022debit\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022internalType\u0022:\u0022uint256\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022gluon\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022id\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022uint32\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint32\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022isOn\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022bool\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022bool\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022old\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022contract OldRegistry\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022apiKey\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022register\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022upgradeOperator_\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022setUpgradeOperator\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022state\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022enum AppState.State\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint8\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022switchOff\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022apiKey\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022translate\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022upgrade\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022upgradeOperator\u0022,\u0022outputs\u0022:[{\u0022internalType\u0022:\u0022address\u0022,\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022}]","ContractName":"RegistryLogic","CompilerVersion":"v0.5.12\u002Bcommit.7709ece9","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"00000000000000000000000075ace7a086ea0fb1a79e43cc6331ad053d8c67cb0000000000000000000000007b70acd346892736f9f6c7f4f196b07400a50da00000000000000000000000000fc25c7931679b838209c484d49df0cb9e633c41","Library":"","SwarmSource":"bzzr://b84dc9109f18f6406962b68829ad917b9ccfdbd4d1999ac0d58d3f2f5961ff8c"}]