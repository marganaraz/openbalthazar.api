[{"SourceCode":"pragma solidity ^0.5.0;\r\n\r\ncontract MainContract {\r\n    function getUserInvestInfo(address addr) public view returns (uint256, uint256, uint256, uint256, uint256, uint256, uint256, uint256, uint256, uint256);\r\n}\r\n\r\ncontract AOQFund {\r\n\r\n    using SafeMath for *;\r\n\r\n    uint ethWei = 1 ether;\r\n    uint256  fundValue;\r\n    uint256  gradeOne;\r\n    uint256  gradeTwo;\r\n    uint256  gradeThree;\r\n    address public mainContract;\r\n    bool public canWithdraw = false;\r\n    address owner;\r\n    uint256 public totalInvestorCount;\r\n\r\n    address payable projectAddress = 0x64d7d8AA5F785FF3Fb894Ac3b505Bd65cFFC562F;\r\n\r\n    uint256 closeTime;\r\n\r\n    uint256 public gradeThreeCount;\r\n    uint256 public gradeTwoCount;\r\n    uint256 public gradeOneCount;\r\n\r\n    uint256 public gradeThreeCountLimit = 10;\r\n    uint256 public gradeTwoCountLimit = 90;\r\n\r\n    struct Invest {\r\n        uint256 level;\r\n        bool withdrawed;\r\n        uint256 lastInvestTime;\r\n        uint256 grade;\r\n    }\r\n\r\n    mapping(uint256 =\u003E uint256) gradeDistribute;\r\n    mapping(address =\u003E Invest) public projectInvestor;\r\n    mapping(address =\u003E bool) admin;\r\n\r\n    constructor () public {\r\n        owner = msg.sender;\r\n        admin[msg.sender] = true;\r\n\r\n        gradeDistribute[3] = 250;\r\n        gradeDistribute[2] = 350;\r\n        gradeDistribute[1] = 400;\r\n\r\n    }\r\n\r\n    //modifier\r\n    modifier onlyOwner() {\r\n        require(msg.sender == owner, \u0022only owner allowed\u0022);\r\n        _;\r\n    }\r\n\r\n    modifier isHuman() {\r\n        address addr = msg.sender;\r\n        uint codeLength;\r\n\r\n        assembly {codeLength := extcodesize(addr)}\r\n        require(codeLength == 0, \u0022sorry humans only\u0022);\r\n        require(tx.origin == msg.sender, \u0022sorry, human only\u0022);\r\n        _;\r\n    }\r\n\r\n    modifier onlyAdmin(){\r\n        require(admin[msg.sender] == true, \u0027only admin can call\u0027);\r\n        _;\r\n    }\r\n\r\n    modifier onlyMainContract(){\r\n        require(msg.sender == mainContract, \u0027only Main Contract\u0027);\r\n        _;\r\n    }\r\n\r\n    modifier isContract() {\r\n        address _addr = msg.sender;\r\n        uint256 _codeLength;\r\n\r\n        assembly {_codeLength := extcodesize(_addr)}\r\n        require(_codeLength != 0, \u0022ERROR_ONLY_CONTRACT\u0022);\r\n        _;\r\n    }\r\n\r\n    function setAdmin(address addr)\r\n    public\r\n    onlyOwner()\r\n    {\r\n        admin[addr] = true;\r\n    }\r\n\r\n    function setCloseTime(uint256 cTime)\r\n    public\r\n    onlyAdmin()\r\n    {\r\n        closeTime = cTime;\r\n    }\r\n\r\n    function setProjectAddress(address payable pAddress)\r\n    public\r\n    onlyAdmin()\r\n    {\r\n        projectAddress = pAddress;\r\n    }\r\n\r\n    function setMainContract(address addr)\r\n    public\r\n    onlyAdmin()\r\n    {\r\n        mainContract = addr;\r\n    }\r\n\r\n    function() external payable {\r\n\r\n    }\r\n\r\n    function setGradeCountLimit(uint256 gradeThreeLimit, uint256 gradeTwoLimit)\r\n    public\r\n    onlyAdmin()\r\n    {\r\n        gradeThreeCountLimit = gradeThreeLimit;\r\n        gradeTwoCountLimit = gradeTwoLimit;\r\n    }\r\n\r\n    function countDownOverSet()\r\n    public\r\n    onlyMainContract()\r\n    isContract()\r\n    {\r\n        fundValue = address(this).balance;\r\n        gradeThree = fundValue.mul(gradeDistribute[3]).div(1000);\r\n        gradeTwo = fundValue.mul(gradeDistribute[2]).div(1000);\r\n        gradeOne = fundValue.sub(gradeThree).sub(gradeTwo);\r\n        closeTime = now \u002B 3 days;\r\n    }\r\n\r\n    function getFundInfo()\r\n    public\r\n    view\r\n    returns (uint256, uint256, uint256, uint256)\r\n    {\r\n        return (fundValue, gradeThree, gradeTwo, gradeOne);\r\n    }\r\n\r\n    function receiveInvest(address investor, uint256 level, bool isNew)\r\n    public\r\n    onlyMainContract()\r\n    isContract()\r\n    {\r\n        uint codeLength;\r\n\r\n        assembly {codeLength := extcodesize(investor)}\r\n        require(codeLength == 0, \u0022not a valid human address\u0022);\r\n\r\n        projectInvestor[investor].level = level;\r\n        projectInvestor[investor].lastInvestTime = now;\r\n\r\n        if (isNew) {\r\n            totalInvestorCount = totalInvestorCount.add(1);\r\n        }\r\n    }\r\n\r\n    function setFrontInvestors(address investor, uint256 grade)\r\n    public\r\n    onlyAdmin()\r\n    {\r\n\r\n        Invest storage investInfo = projectInvestor[investor];\r\n\r\n        require(investInfo.level \u003E= 1 \u0026\u0026 investInfo.withdrawed == false, \u0027invalid investor\u0027);\r\n        require(canWithdraw == false, \u0027invalid period\u0027);\r\n        require(grade \u003C 4, \u0027invalid grade\u0027);\r\n\r\n        if (grade == 3 \u0026\u0026 investInfo.grade != 3) {\r\n            require(gradeThreeCount \u003C= gradeThreeCountLimit, \u0027only 10 count allowed\u0027);\r\n            gradeThreeCount = gradeThreeCount.add(1);\r\n            if (investInfo.grade == 2) {\r\n                gradeTwoCount = gradeTwoCount.sub(1);\r\n            }\r\n        }\r\n        if (grade == 2 \u0026\u0026 investInfo.grade != 2) {\r\n            require(gradeTwoCount \u003C= gradeTwoCountLimit, \u0027only 90 count allowed\u0027);\r\n            gradeTwoCount = gradeTwoCount.add(1);\r\n            if (investInfo.grade == 3) {\r\n                gradeThreeCount = gradeThreeCount.sub(1);\r\n            }\r\n        }\r\n        if (grade \u003C 2 \u0026\u0026 investInfo.grade \u003E= 2) {\r\n            if (investInfo.grade == 2) {\r\n                gradeTwoCount = gradeTwoCount.sub(1);\r\n            }\r\n            if (investInfo.grade == 3) {\r\n                gradeThreeCount = gradeThreeCount.sub(1);\r\n            }\r\n        }\r\n\r\n        investInfo.grade = grade;\r\n\r\n    }\r\n\r\n    function setGradeOne(uint256 num)\r\n    public\r\n    onlyAdmin()\r\n    {\r\n        gradeOneCount = num;\r\n    }\r\n\r\n    function openCanWithdraw(uint256 open)\r\n    public\r\n    onlyAdmin()\r\n    {\r\n        if (open == 1) {\r\n            canWithdraw = true;\r\n        } else {\r\n            canWithdraw = false;\r\n        }\r\n    }\r\n\r\n    function getInvest(address investor) internal view returns (uint256){\r\n        MainContract mainContractIns = MainContract(mainContract);\r\n        uint256 three;\r\n        (,,three,,,,,,,) = mainContractIns.getUserInvestInfo(investor);\r\n        return three;\r\n    }\r\n\r\n    function withdrawFund()\r\n    public\r\n    isHuman()\r\n    {\r\n        require(canWithdraw == true, \u0027can not withdraw now\u0027);\r\n\r\n        Invest storage investInfo = projectInvestor[msg.sender];\r\n        require(investInfo.withdrawed == false, \u0027withdrawed address\u0027);\r\n\r\n        uint256 withdrawAmount;\r\n\r\n        withdrawAmount = getFundReward(msg.sender);\r\n\r\n        if (withdrawAmount \u003E 0) {\r\n            investInfo.withdrawed = true;\r\n        }\r\n\r\n        msg.sender.transfer(withdrawAmount);\r\n\r\n    }\r\n\r\n    function getFundReward(address addr)\r\n    public\r\n    view\r\n    isHuman()\r\n    returns (uint256)\r\n    {\r\n\r\n        Invest storage investInfo = projectInvestor[addr];\r\n\r\n        uint256 withdrawAmount = 0;\r\n\r\n        uint256 freeze;\r\n        freeze = getInvest(addr);\r\n\r\n        if (canWithdraw != false \u0026\u0026 investInfo.withdrawed != true \u0026\u0026 freeze \u003E 0) {\r\n\r\n            if (investInfo.grade == 3 \u0026\u0026 gradeThreeCount \u003E 0) {\r\n                withdrawAmount = gradeThree.div(gradeThreeCount);\r\n            } else if (investInfo.grade == 2 \u0026\u0026 gradeTwoCount \u003E 0) {\r\n                withdrawAmount = gradeTwo.div(gradeTwoCount);\r\n            }\r\n\r\n            if (investInfo.grade \u003C 2 \u0026\u0026 gradeOneCount \u003E 0) {\r\n                withdrawAmount = gradeOne.div(gradeOneCount);\r\n            }\r\n        }\r\n\r\n        return withdrawAmount;\r\n\r\n    }\r\n\r\n    function close() public\r\n    onlyOwner()\r\n    {\r\n        require(canWithdraw == true \u0026\u0026 gradeThreeCount \u003E 0, \u0027Game is not start over now!\u0027);\r\n        require(now \u003E closeTime, \u0027only 3 days later Game Over\u0027);\r\n        selfdestruct(projectAddress);\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * @title SafeMath\r\n * @dev Math operations with safety checks that revert on error\r\n */\r\nlibrary SafeMath {\r\n\r\n    /**\r\n    * @dev Multiplies two numbers, reverts on overflow.\r\n    */\r\n    function mul(uint256 a, uint256 b) internal pure returns (uint256) {\r\n        // Gas optimization: this is cheaper than requiring \u0027a\u0027 not being zero, but the\r\n        // benefit is lost if \u0027b\u0027 is also tested.\r\n        // See: https://github.com/OpenZeppelin/openzeppelin-solidity/pull/522\r\n        if (a == 0) {\r\n            return 0;\r\n        }\r\n\r\n        uint256 c = a * b;\r\n        require(c / a == b, \u0022mul overflow\u0022);\r\n\r\n        return c;\r\n    }\r\n\r\n    /**\r\n    * @dev Integer division of two numbers truncating the quotient, reverts on division by zero.\r\n    */\r\n    function div(uint256 a, uint256 b) internal pure returns (uint256) {\r\n        require(b \u003E 0, \u0022div zero\u0022);\r\n        // Solidity only automatically asserts when dividing by 0\r\n        uint256 c = a / b;\r\n        // assert(a == b * c \u002B a % b); // There is no case in which this doesn\u0027t hold\r\n\r\n        return c;\r\n    }\r\n\r\n    /**\r\n    * @dev Subtracts two numbers, reverts on overflow (i.e. if subtrahend is greater than minuend).\r\n    */\r\n    function sub(uint256 a, uint256 b) internal pure returns (uint256) {\r\n        require(b \u003C= a, \u0022lower sub bigger\u0022);\r\n        uint256 c = a - b;\r\n\r\n        return c;\r\n    }\r\n\r\n    /**\r\n    * @dev Adds two numbers, reverts on overflow.\r\n    */\r\n    function add(uint256 a, uint256 b) internal pure returns (uint256) {\r\n        uint256 c = a \u002B b;\r\n        require(c \u003E= a, \u0022overflow\u0022);\r\n\r\n        return c;\r\n    }\r\n\r\n    /**\r\n    * @dev Divides two numbers and returns the remainder (unsigned integer modulo),\r\n    * reverts when dividing by zero.\r\n    */\r\n    function mod(uint256 a, uint256 b) internal pure returns (uint256) {\r\n        require(b != 0, \u0022mod zero\u0022);\r\n        return a % b;\r\n    }\r\n}","ABI":"[{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022gradeOneCount\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022name\u0022:\u0022investor\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022name\u0022:\u0022grade\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022setFrontInvestors\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022countDownOverSet\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022gradeThreeCount\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022name\u0022:\u0022open\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022openCanWithdraw\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022name\u0022:\u0022cTime\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022setCloseTime\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022name\u0022:\u0022addr\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022setMainContract\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022name\u0022:\u0022num\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022setGradeOne\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022close\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022name\u0022:\u0022investor\u0022,\u0022type\u0022:\u0022address\u0022},{\u0022name\u0022:\u0022level\u0022,\u0022type\u0022:\u0022uint256\u0022},{\u0022name\u0022:\u0022isNew\u0022,\u0022type\u0022:\u0022bool\u0022}],\u0022name\u0022:\u0022receiveInvest\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022name\u0022:\u0022gradeThreeLimit\u0022,\u0022type\u0022:\u0022uint256\u0022},{\u0022name\u0022:\u0022gradeTwoLimit\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022name\u0022:\u0022setGradeCountLimit\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022projectInvestor\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022level\u0022,\u0022type\u0022:\u0022uint256\u0022},{\u0022name\u0022:\u0022withdrawed\u0022,\u0022type\u0022:\u0022bool\u0022},{\u0022name\u0022:\u0022lastInvestTime\u0022,\u0022type\u0022:\u0022uint256\u0022},{\u0022name\u0022:\u0022grade\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022name\u0022:\u0022addr\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022setAdmin\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022gradeTwoCountLimit\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022totalInvestorCount\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[{\u0022name\u0022:\u0022addr\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022getFundReward\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022canWithdraw\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022bool\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022mainContract\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[],\u0022name\u0022:\u0022withdrawFund\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022gradeTwoCount\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022gradeThreeCountLimit\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:true,\u0022inputs\u0022:[],\u0022name\u0022:\u0022getFundInfo\u0022,\u0022outputs\u0022:[{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022},{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022},{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022},{\u0022name\u0022:\u0022\u0022,\u0022type\u0022:\u0022uint256\u0022}],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022view\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022constant\u0022:false,\u0022inputs\u0022:[{\u0022name\u0022:\u0022pAddress\u0022,\u0022type\u0022:\u0022address\u0022}],\u0022name\u0022:\u0022setProjectAddress\u0022,\u0022outputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022function\u0022},{\u0022inputs\u0022:[],\u0022payable\u0022:false,\u0022stateMutability\u0022:\u0022nonpayable\u0022,\u0022type\u0022:\u0022constructor\u0022},{\u0022payable\u0022:true,\u0022stateMutability\u0022:\u0022payable\u0022,\u0022type\u0022:\u0022fallback\u0022}]","ContractName":"AOQFund","CompilerVersion":"v0.5.0\u002Bcommit.1d4f565a","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"","Library":"","SwarmSource":"bzzr://042ccdcee403dae72a5fdb2096af51fa115b3637534473cb0b8d5a211dd5e4f7"}]